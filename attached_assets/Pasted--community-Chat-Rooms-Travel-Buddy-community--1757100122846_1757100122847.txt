×œ×”×¤×•×š ××ª /community ×œ×¤×•× ×§×¦×™×•× ×œ×™ (Chat Rooms + Travel Buddy)

×¢×“×›×Ÿ ××ª ×”×“×£ ×”×§×™×™× /community (××œ ×ª×™×¦×•×¨ ×“×£ ×—×“×©). ×‘× ×” ×‘×• ×©× ×™ ××–×•×¨×™ ×¢×‘×•×“×” (×˜××‘×™×/×¡×™×™×“×‘×¨):

Chat Rooms â€” ×¨×©×™××ª ×—×“×¨×™× + ×¦â€™××˜ ×‘×–××Ÿ ×××ª ×œ×›×œ ×—×“×¨

Travel Buddy Board â€” ×œ×•×— ××•×“×¢×•×ª ×œ××¦×™××ª ×©×•×ª×¤×™/×•×ª × ×¡×™×¢×”

×”×©×ª××© ×‘-Supabase (client ×§×™×™×) ×•×‘×˜×‘×œ××•×ª: public.chat_rooms, public.messages, public.travel_buddy_posts. ××™×Ÿ ×œ×”×§×©×™×— ××¤×ª×—×•×ª; ENV ×‘×œ×‘×“.

A) Chat Rooms

UI:

×¡×™×™×“×‘×¨ ×©××¦×™×’ ××ª ×›×œ ×”Ö¾chat_rooms (×©× ×—×“×¨, ×ª×™××•×¨/××“×™× ×” ×× ×§×™×™××™×, ××•× ×” ×”×•×“×¢×•×ª ××—×¨×•× ×•×ª).

××–×•×¨ ××¨×›×–×™: ×›×•×ª×¨×ª ×—×“×¨, ×¨×©×™××ª ×”×•×“×¢×•×ª ×¢× ××™× ×¡×•×£-×¡×§×•×œ (infinite scroll ×œ××¢×œ×”), ×•×ª×™×‘×ª ×›×ª×™×‘×” (composer) ×œ××˜×”.

××¦×‘ ×¨×™×§ (×× ××™×Ÿ ×”×•×“×¢×•×ª): â€œNo messages yet â€” be the first to say hi ğŸ‘‹â€.

×©×œ×™×¤×•×ª:

chat_rooms: ×”×¦×’ ×©×“×•×ª ×§×™×™××™× (×œ××©×œ: id, name, description, country, created_at â€” ×“×œ×’ ×‘×©×§×˜ ×× ×©×“×” ×œ× ×§×™×™×).

messages: ×¢×‘×•×¨ ×—×“×¨ × ×‘×—×¨ ×©×œ×•×£ ×¢××•×“ ×¨××©×•×Ÿ ×œ×¤×™ order(created_at, asc) ×¢× range() (×‘×¨×™×¨×ª ××—×“×œ 30). ×©××•×¨ ××¤×ª×— â€œlast seen id/tsâ€ ×œ×˜×¢×™× ×ª ×¢×‘×¨.

Realtime:

×”×™×¨×©× ×œÖ¾realtime ×¢×œ public.messages ××¡×•× ×Ÿ ×œ×¤×™ room_id (××• ×”×©×“×” ×”××§×‘×™×œ) ×•×”×•×¡×£ ×”×•×“×¢×•×ª ×—×“×©×•×ª ×œÖ¾UI (scroll-stick ×œ×ª×—×ª×™×ª ×× ×”××©×ª××© ×œ××˜×”).

× ×˜×¨ × ×™×ª×•×§/×—×™×‘×•×¨ ××—×“×©, ×•××œ ×ª×›×¤×™×œ ×××–×™× ×™×.

×©×œ×™×—×ª ×”×•×“×¢×•×ª (Composer):

×× ×™×© ××¢×¨×›×ª Auth ×¤×¢×™×œ×” â€” ××œ× user_id/author ×Ö¾auth.user().

×× ××™×Ÿ Auth (××¦×œ×š ×›×¨×’×¢ users ×¨×™×§): ××¤×©×¨ ××¦×‘ Guest:

×©××•×¨ guest_name (nickname) ×‘-localStorage.

×‘×¢×ª insert ×œÖ¾messages ×©×œ×— author_name: guest_name (×•×©×“×•×ª × ×•×¡×¤×™× ×©×§×™×™××™× ×‘×˜×‘×œ×”).

Optimistic UI: ×”×¦×’ ××ª ×”×”×•×“×¢×” ××™×“, ×•×× insert × ×›×©×œ â€” ×¡××Ÿ ğŸ” ×•× ×¡×” ×©×•×‘.

×•×œ×™×“×¦×™×”: ×˜×§×¡×˜ ×œ× ×¨×™×§, ×—×™×ª×•×š ×œ××•×¨×š ××§×¡×™××œ×™ (×œ××©×œ 2,000 ×ª×•×•×™×), ×× ×˜×™-×¡×¤×× ×‘×¡×™×¡×™ (debounce).

××™× ×¡×•×£-×¡×§×•×œ ×œ××¢×œ×”:

×‘×œ×—×™×¦×”/×’×œ×™×œ×” ×œ××¢×œ×” â€” ×˜×¢×Ÿ ×¢××•×“×™× ×§×•×“××™× (lte(created_at, firstLoadedTs)) ×¢×“ ×©× ×’××¨.

B) Travel Buddy Board

UI:

×œ×™×¡×˜×” ×©×œ ××•×“×¢×•×ª travel_buddy_posts ×¢× ×›×¨×˜×™×¡×™×: ×›×•×ª×¨×ª/×™×¢×“, ×ª××¨×™×›×™× (from-to), ×ª×™××•×¨ ×§×¦×¨, ×ª×§×¦×™×‘/×¡×’× ×•×Ÿ (×× ×§×™×™××™× ×¢××•×“×•×ª), ×•Ö¾CTA â€œContactâ€.

×¤×× ×œ ×¤×™×œ×˜×¨×™×: ××“×™× ×”/×¢×™×¨, ×—×œ×•×Ÿ ×ª××¨×™×›×™×, ×˜×•×•×— ×ª×§×¦×™×‘ (×× ×§×™×™×), ××™×œ×ª ×—×™×¤×•×©.

×›×¤×ª×•×¨ â€œNew Postâ€ ×©×¤×•×ª×— Modal/Drawer ×¢× ×˜×•×¤×¡ ×™×¦×™×¨×ª ××•×“×¢×”.

CRUD:

Create: ×˜×•×¤×¡ ×•×œ×™×“×¦×™×” (×©×“×•×ª ×—×•×‘×”: ×›×•×ª×¨×ª/×™×¢×“ + ×˜×•×•×— ×ª××¨×™×›×™×).

×× ×™×© Auth â€” ×©××•×¨ user_id/author.

×× ××™×Ÿ â€” ×‘×§×© contact_method (×œ××©×œ ××™××™×™×œ/×˜×œ×’×¨×) ×•Ö¾display_name ×•×©××•×¨ ××•×ª× ×‘×©×“×•×ª ×”××ª××™××™×.

Read: ×¢×™××•×“ range() (×‘×¨×™×¨×ª ××—×“×œ 20), order(created_at desc), ×—×™×¤×•×© ilike ×¢×œ ×›×•×ª×¨×ª/×™×¢×“.

Update/Delete: ×× ×™×© Auth â€” ××¤×©×¨ ×¢×¨×™×›×”/××—×™×§×” ×¨×§ ×œ×‘×¢×œ×™× (×‘×“×•×§ user_id === auth.uid()). ×× ××™×Ÿ Auth â€” ×”×©××¨ ×œ×§×¨×™××” ×‘×œ×‘×“ (××• ××¤×©×¨ ×¢×¨×™×›×” ×¢× token ×§×¦×¨ ×‘-localStorage ×¨×§ ×œ×¤×•×¡×˜ ×©×–×” ×¢×ª×” × ×•×¦×¨ â€” ××•×¤×¦×™×•× ×œ×™).

Contact / Reply:

××•×¤×¦×™×” 1 (××”×™×¨): ×›×¤×ª×•×¨ â€œContactâ€ ×¤×•×ª×— Modal ×¢× ×¤×¨×˜×™ ×§×©×¨ ×©×”×•×’×“×¨×• ×‘×¤×•×¡×˜ (××™×™×œ/×˜×œ×’×¨×), ××• ×›×¤×ª×•×¨ â€œStart chatâ€ ×©×™×•×¦×¨/×¤×•×ª×— chat_room ×™×™×¢×•×“×™ ×‘×™×Ÿ ×”×¦×“×“×™× (×× ×™×© ×× ×’× ×•×Ÿ ×›×–×”).

××•×¤×¦×™×” 2 (×¨×§ ×× ×ª×¨×¦×”): ×©×œ×— â€œinterest messageâ€ ×œ×˜×‘×œ×ª messages ×‘×—×“×¨ ×›×œ×œ×™ (×œ××©×œ â€œ#travel-buddyâ€) ×¢× ×§×™×©×•×¨ ×œ×¤×•×¡×˜.

C) ×”×¨×©××•×ª (RLS) â€” ×ª×™×¢×•×“ ×•××¡×œ×•×œ DEV

×”×•×¡×£ ×§×•×‘×¦×™ ×¢×–×¨×” ×‘×œ×‘×“ (×œ× ×œ×”×¨×™×¥ ××•×˜×•××˜×™×ª) ×‘×ª×™×§×™×™×ª docs/ ×•Ö¾scripts/:

scripts/printCommunityPolicies.sql â€” ×©×•×¨×” ×œ×›×œ ×˜×‘×œ×” ×”××¦×™×’×” ××“×™× ×™×•×ª ×§×™×™××ª.

docs/community-rls.md â€” ×”×¡×‘×¨ ×§×¦×¨ + SQL ×œ×‘×—×™×¨×ª×š:

××¦×‘ DEV ××”×™×¨ (×§×¨×™××”/×›×ª×™×‘×” ×—×•×¤×©×™×™×):

alter table public.chat_rooms enable row level security;
alter table public.messages enable row level security;
alter table public.travel_buddy_posts enable row level security;

create policy "public read chat_rooms" on public.chat_rooms for select using (true);
create policy "public read messages"  on public.messages  for select using (true);
create policy "public read tb_posts"  on public.travel_buddy_posts for select using (true);

-- ×œ-DEV ×‘×œ×‘×“: ×××¤×©×¨ ×’× insert ×œ×›×•×œ×
create policy "public write messages" on public.messages for insert with check (true);
create policy "public write tb_posts" on public.travel_buddy_posts for insert with check (true);


××¦×‘ PROD (×× Auth ××•×¤×¢×œ):
insert/update/delete ×¨×§ ×›××©×¨ user_id = auth.uid(); select ×œ×›×•×œ× (××• ××¡×•× ×Ÿ ×œ×¤×™ ×—×“×¨×™× ×¤×¨×˜×™×™×, ×× ×™×©).
×”×¡×‘×¨ ××™×š ×œ×”×ª××™× ×œ×¤×™ ×©××•×ª ×”×©×“×•×ª ×©×œ×š (×œ××©×œ author_id/user_id).

×—×©×•×‘: ×× ××™×Ÿ ×œ×š ×›×¨×’×¢ Auth, ×ª×ª×—×™×œ ×Ö¾DEV-open ×œ×›×ª×™×‘×” (×›××• ×œ××¢×œ×”) ×›×“×™ ×œ×”×“×’×™× ×¤×•× ×§×¦×™×•× ×œ×™×•×ª, ×•××—×´×› ×ª×—×–×§.

D) ×”×ª×××•×ª ×¡×›×™××” ×¨×›×•×ª (×œ×œ× ×©×‘×™×¨×ª ×§×™×™×)

×”×§×•×“ ×—×™×™×‘ ×œ×¢×‘×•×“ ×’× ×× ×—×œ×§ ××”×¢××•×“×•×ª ×œ× ×§×™×™××•×ª. ×œ×›×Ÿ ×‘×›×œ select():

×‘×§×© ×¨×§ ×¢××•×“×•×ª ×©××ª×” ××¦×™×’ ×‘×¤×•×¢×œ, ×•×“×œ×’ ×‘×¢×“×™× ×•×ª ×× undefined.

×‘×”×•×“×¢×•×ª, × ×¡×” ××ª ×”×©×“×•×ª ×”× ×¤×•×¦×™×: id, room_id, user_id, author_name, content, created_at.

×‘×¦â€™××˜, ×× ××™×Ÿ author_name â€” ×”×¦×’ user_id ××§×•×¦×¨ ××• â€œGuestâ€.

E) ×—×•×•×™×™×ª ××©×ª××© ×§×˜× ×” ××š ×—×©×•×‘×”

×ª××¨×™×š/×©×¢×”: ×”×¦×’ ×œ×™×“ ×›×œ ×”×•×“×¢×” ×–××Ÿ ×™×—×¡×™ (â€œ3mâ€, â€œ2hâ€, â€œyesterdayâ€). Tooltip ×¢× ×–××Ÿ ××œ×.

Avatar: ××•×ª ×¨××©×•× ×” ×©×œ ×”×©×/××™××•×’×³×™ ×‘×¨×™×¨×ª ××—×“×œ.

××“×™× ×•×ª: ×× ×™×© ×¢××•×“×ª country ×‘Ö¾chat_rooms/travel_buddy_posts â€” ×”×•×¡×£ ×¤×™×œ×˜×¨ â€œAll Countries / Countryâ€¦â€.

×©×’×™××•×ª: toast ×‘×¨×•×¨ (×œ××©×œ â€œCanâ€™t send message â€” check connectionâ€).

× ×’×™×©×•×ª: ×§×™×¦×•×¨×™ ××§×œ×“×ª (Enter ×œ×©×œ×™×—×”, Shift+Enter ×œ×©×•×¨×” ×—×“×©×”), aria-labels, ×¤×•×§×•×¡ ×œ-composer ×›×©× ×›× ×¡×™× ×œ×—×“×¨.

Empty states ×™×¤×™×: ×× ×™××¦×™×™×ª â€œwave handâ€ ×‘×¦â€™××˜ ×¨×™×§; ××™×™×§×•×Ÿ ×ª×¨××™×œ ×‘×œ×•×— ××•×“×¢×•×ª ×¨×™×§.

F) ×§×‘×¦×™×/×§×•××¤×•× × ×˜×™× (×”×ª×× ×œ××‘× ×” ×©×œ×š)

pages/community.tsx (××• ×”×§×™×™× ××¦×œ×š â€” ×œ×¢×“×›×Ÿ ×‘×œ×‘×“)

src/components/community/ChatSidebar.tsx â€” ×¨×©×™××ª ×—×“×¨×™×

src/components/community/RoomView.tsx â€” ×ª×¦×•×’×ª ×—×“×¨ + ×”×•×“×¢×•×ª + composer

src/components/community/MessageItem.tsx â€” ×”×•×“×¢×” ×‘×•×“×“×ª

src/components/community/TravelBuddyList.tsx â€” ×¨×©×™××ª ××•×“×¢×•×ª + ×¤×™×œ×˜×¨×™×

src/components/community/NewBuddyPostModal.tsx â€” ×™×¦×™×¨×ª ××•×“×¢×”

src/lib/communityApi.ts â€” ×§×¨×™××•×ª Supabase ××¨×•×›×–×•×ª (select/insert/realtime)

scripts/printCommunityPolicies.sql, docs/community-rls.md

×©××•×¨ ×¡×˜×™×™×œ ××—×™×“ (Tailwind/shadcn), ×¨×¡×¤×•× ×¡×™×‘×™, RTL-ready.

G) ×§×‘×œ×” (Acceptance)

× ×™×•×•×˜ ×œÖ¾/community ××¦×™×’ ×©× ×™ ×˜××‘×™×: Chat Rooms ×•-Travel Buddy Board.

Chat Rooms:

×¨×•××” ×¨×©×™××ª ×—×“×¨×™×; ×‘×—×™×¨×ª ×—×“×¨ ××¦×™×’×” ×”×•×“×¢×•×ª ×§×™×™××•×ª + ×”×•×“×¢×•×ª ×—×“×©×•×ª ×‘×–××Ÿ ×××ª.

× ×™×ª×Ÿ ×œ×©×œ×•×— ×”×•×“×¢×” (Guest nickname ×× ××™×Ÿ Auth).

××™× ×¡×•×£-×¡×§×•×œ ×œ×˜×¢×™× ×ª ×¢×‘×¨; ××¦×‘ ×¨×™×§ ×‘×¨×•×¨.

Travel Buddy Board:

×¨×•××” ×›×¨×˜×™×¡×™ ××•×“×¢×•×ª ×¢× ×¤×™×œ×˜×¨×™×; × ×™×ª×Ÿ ×œ×™×¦×•×¨ ××•×“×¢×” ×—×“×©×” (×‘××¦×‘ DEV ×’× ×‘×œ×™ Auth).

××™×Ÿ ×”×§×©×—×ª ××¤×ª×—×•×ª; ENV ×‘×œ×‘×“.

××™×Ÿ ×©×‘×™×¨×ª ×“×¤×™× ××—×¨×™×.

×™×© ××¡××›×™ RLS/SQL ×œ×¢×–×¨×”, ×œ× ××‘×•×¦×¢ ××•×˜×•××˜×™×ª.

Commit ×‘×¡×•×£:
feat(community): chat rooms with realtime + travel buddy board (filters, new post, guest mode)